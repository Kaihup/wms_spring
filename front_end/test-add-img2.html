<input type="text" id="ipname" name="imgname" />
<input type="file" id="files" name="files" />
<br />
<button onclick="confirmPostProduct()">button</button>

<script>


    function confirmPostProduct() {
        console.log("first part");
        var file = document.getElementById('files').files[0];
        if (file) {
            handleFileSelect(file);
            console.log(file.name);
        } else {
            console.log("skip the middle part")
            postProduct(null);
        }
    }

    function handleFileSelect(file) {
        //var file = document.getElementById('files').files[0]; // FileList object
        var reader = new FileReader();
        var base64String = '';
        // Closure to capture the file information.
        reader.onload = (function (theFile) {
            return function (e) {
                var binaryData = e.target.result;
                //Converting Binary Data to base 64
                base64String = window.btoa(binaryData);
                //log file converted to base64
                //console.log(base64String);
                console.log("middle part");
                postProduct(base64String);

            };
        })(file);
        // Read in the image file as a data URL.
        if (file) {
            reader.readAsBinaryString(file);
        }

    }

    function postProduct(base64String) {


        console.log("last part")
        console.log(base64String);

        var xhr = new XMLHttpRequest();
        var theObject = {};
        theObject.name = document.getElementById("ipname").value;
        theObject.datafoto = base64String;


        xhr.onreadystatechange = function () {

        };

        var objJSON = JSON.stringify(theObject);
        console.log(objJSON);
        xhr.open("POST", "http://localhost:8082/ptestnext123", true);
        xhr.setRequestHeader("Content-Type", "application/json");
        xhr.send(objJSON);
    }

</script>