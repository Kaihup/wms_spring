<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <input id="fileInput" type="file"><br>
    <input id="submit" type="button" onclick="previewFile()"><br>
    <img id="theFile" src="" height="200" alt="Image preview...">

    <hr>
    Name:
    <input id="productName" type="text"><br>
    File:
    <input id="productImgFile" type="file"><br>
    <input type="submit" value="Click me" onclick="gatherFileData()">

</body>
<script>

    function gatherFileData() {

        const name = document.getElementById("productName").value;
        console.log(name);
        const file = document.querySelector('#productImgFile').files[0];
        const reader = new FileReader();

        var blobData;

        reader.addEventListener("load", function () {
            // convert image file to base64 string
            blobData = reader.result;
            console.log("BLOBDATA");
            console.log(blobData);
            postFieldData(name, blobData);
        }, false);

        if (file) {
            console.log("with file1");
            reader.readAsDataURL(file);
        } else {
            console.log("no file");
            postFieldData(name, null);
        }
    }

    function postFieldData(name, blobData) {


        var fileData = {};


        fileData.name = name;
        fileData.dataBlob = blobData;

        console.log(fileData);

        // var objJSON = JSON.stringify(fileData);
        // var xhr = new XMLHttpRequest();
        // xhr.onreadystatechange = function () {
        //     console.log("FileData is saved");
        // };
        // xhr.open("POST", "http://localhost:8082/newbox/" + productp, true);
        // xhr.setRequestHeader("Content-Type", "application/json");
        // xhr.send(objJSON);
        // document.getElementById("boxesTable");
    }

    function previewFile() {
        const preview = document.querySelector('#theFile');
        const file = document.querySelector('#fileInput').files[0];
        const reader = new FileReader();

        reader.addEventListener("load", function () {
            // convert image file to base64 string
            console.log(reader.result);
            // preview.src = reader.result;
        }, false);

        if (file) {
            reader.readAsDataURL(file);
        }
    }

</script>

</html>